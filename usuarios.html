<!DOCTYPE html>
<html lang="pt-br" dir="ltr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciar Usuários</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="assets/css/usuarios.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body onload="carregarUsuarios()">

    <header>
        <a href="home.html"><img src="assets/img/Ariel (1) 4.png" alt=""></a>

        <div class="container">
            <search class="pesquisa">
                <input class="barra-pesquisar" type="text" placeholder="Pesquisar na AutoPrime">
                <button class="botao-pesquisar"><i class="fa-solid fa-magnifying-glass"></i></button>
            </search>

            <i class="fa-solid fa-circle-user"></i>
        </div>
    </header>

    <section class="banner">
        <img src="assets/img/PONTEIRAS DE 1.png" alt="">
    </section>

    <section class="main">
        <h1>Gerenciar Usuários</h1>
        <div class="cards-container">

            <div class="usuario">

                <div class="icone">
                    <i class="fa-solid fa-user"></i>
                </div>
                <div class="info">
                    <p>usuario@gmail.com</p>
                    <h2 class="criado-em">Criado em: 22/09/2025</h2>
                </div>

            </div>

            <div class="informacoes">

                <div class="usuarios">

                    <div class="info-titulo">
                        <i class="fa-solid fa-user"></i>
                        <p>Usuários</p>
                    </div>
                    <div class="info-segmento-usuarios">
                        <p class="numero-info">500</p>
                        <a class="gerenciar" href="usuarios.html">Gerenciar</a>
                    </div>
                </div>

                <div class="usuarios">

                    <div class="info-titulo">
                        <i class="fa-solid fa-cart-shopping"></i>
                        <p>Vendas</p>
                    </div>
                    <div class="info-segmento-vendas">
                        <p class="numero-info">400.000</p>
                        <a class="gerenciar" href="vendas.html">Gerenciar</a>
                    </div>
                </div>

                <div class="usuarios">

                    <div class="info-titulo">
                        <i class="fa-solid fa-bag-shopping"></i>
                        <p>Produtos</p>
                    </div>
                    <div class="info-segmento-produtos">
                        <p class="numero-info">50.000</p>
                        <a class="gerenciar" href="produtos.html">Gerenciar</a>
                    </div>
                </div>

                <div class="usuarios">

                    <div class="info-titulo">
                        <i class="fa-solid fa-dollar-sign"></i>
                        <p>Cashback</p>
                    </div>
                    <div class="info-segmento-cashback">
                        <p class="numero-info">R$600,00</p>
                        <a class="gerenciar" href="cashback.html">Gerenciar</a>
                    </div>
                </div>

            </div>

        </div>

        <div class="botoes">

            <a href="usuarios.html" class="botao-gerenciar"><i class="fa-solid fa-user"></i>Gerenciar Usuários</a>

            <a href="vendas.html" class="botao-gerenciar"><i class="fa-solid fa-cart-shopping"></i>Gerenciar Vendas</a>

            <a href="produtos.html" class="botao-gerenciar"><i class="fa-solid fa-bag-shopping"></i>Gerenciar
                Produtos</a>

            <a href="cashback.html" class="botao-gerenciar"><i class="fa-solid fa-dollar-sign"></i>Gerenciar
                Cashback</a>

        </div>

        <div class="cards-usuarios">

            <div class="card-cliente">
                <h3>Clientes:</h3>
                <div class="icon-numero">
                    <i class="fa-solid fa-user"></i>
                    <p class="numero" id="clientesCount">0</p>
                </div>
            </div>

            <div class="card-vendedor">
                <h3>Vendedores:</h3>
                <div class="icon-numero">
                    <i class="fa-solid fa-cart-shopping"></i>
                    <p class="numero" id="vendedoresCount">0</p>
                </div>
            </div>

            <div class="card-adm">
                <h3>ADM's:</h3>
                <div class="icon-numero">
                    <i class="fa-solid fa-star"></i>
                    <p class="numero" id="admsCount">0</p>
                </div>
            </div>

        </div>


        <div class="total-usuarios">

            <div class="sofie">

                <p class="todos-usuarios">Todos os usuários:</p>

                <h2 id="total">500</h2>

            </div>

            <a class="botao-add" href="adicionarusuarios.html"><i class="fa-solid fa-plus"></i> Adicionar Usuário</a>

        </div>

        <div class="tabela" id="listarUsuario"></div>

        <div id="pagination" class="pagination"></div>

    </section>
</body>

<script>
    function carregarUsuarios() {
        const requestOptions = { method: "GET", redirect: "follow" };

        fetch("http://192.168.1.122:5000/cadastro", requestOptions)
            .then((response) => response.json())
            .then((result) => {
                // array com todos os cadastros
                const cadastros = result.cadastro || result || [];
                // variáveis de paginação
                const perPage = 11;
                let currentPage = 1;
                const totalPages = Math.max(1, Math.ceil(cadastros.length / perPage));

                // contadores por cargo (baseados na lista completa)
                let clientes = 0, vendedores = 0, adms = 0;
                cadastros.forEach(item => {
                    const cargo = (item.cargo || '').toString().toLowerCase().trim();
                    if (["cliente", "clientes", "client"].includes(cargo)) clientes++;
                    else if (["vendedor", "vendedores", "vendas", "seller", "sales"].includes(cargo)) vendedores++;
                    else if (["adm", "admin", "administrador", "administradora", "administrador(a)"].includes(cargo)) adms++;
                });

                const fmt = (n) => n.toLocaleString('pt-BR');
                const clientesEl = document.getElementById("clientesCount");
                const vendedoresEl = document.getElementById("vendedoresCount");
                const admsEl = document.getElementById("admsCount");
                const totalEl = document.getElementById("total");
                if (clientesEl) clientesEl.textContent = fmt(clientes);
                if (vendedoresEl) vendedoresEl.textContent = fmt(vendedores);
                if (admsEl) admsEl.textContent = fmt(adms);
                if (totalEl) totalEl.textContent = fmt(cadastros.length);

                const container = document.getElementById("listarUsuario");
                const paginationEl = document.getElementById("pagination");

                function renderPage(page) {

                    if (page < 1) page = 1;
                    if (page > totalPages) page = totalPages;
                    currentPage = page;

                    const start = (page - 1) * perPage;
                    const end = start + perPage;
                    const slice = cadastros.slice(start, end);

                    let html = "";
                    slice.forEach(item => {
                        const raw = item.ativo;
                        const isAtivo = (
                            raw === 1 || raw === '1' ||
                            raw === true || String(raw).toLowerCase() === 'true' ||
                            String(raw).toLowerCase() === 'ativo'
                        );
                        const statusLabel = isAtivo ? "Ativo" : "Inativo";

                        const cargoRaw = (item.cargo || '').toString().toLowerCase();
                        let iconClass = "fa-user";
                        if (cargoRaw.includes("adm") || cargoRaw.includes("admin") || cargoRaw.includes("administrador")) {
                            iconClass = "fa-star";
                        } else if (cargoRaw.includes("vend") || cargoRaw.includes("vendas") || cargoRaw.includes("seller")) {
                            iconClass = "fa-cart-shopping";
                        } else {
                            iconClass = "fa-user";
                        }

                        html += `
                        <div class="usuario-linha">
                            <div class="usuario-detalhes">
                                <div class="icone"><i class="fa-solid ${iconClass}"></i></div>
                                <div class="separacao-nome-info">
                                    <div class="nome"><p>${item.email || ''}</p></div>
                                    <div class="info-usuario">
                                        <div class="informacoes-mais">
                                            <p>Nome: <span class="negrito">${item.nome || '-'}</span></p>
                                            <p>Cargo: <span class="negrito">${item.cargo || '-'}</span></p>
                                            <p>Status: <span class="status ${isAtivo ? 'ativo' : 'inativo'}">${statusLabel}</span></p>
                                        </div>
                                        <a class="botao-editar" href="editar.html?id=${item.id || item.id_cadastro || ''}">Editar</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    });

                    container.innerHTML = html;
                    renderPaginationControls();
                    // rolar pro topo da lista quando trocar página (opcional)
                    container.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }

                // Renderiza os botões de paginação
                function renderPaginationControls() {
                    if (!paginationEl) return;
                    // quando só 1 página, pode esconder os controles
                    if (totalPages <= 1) {
                        paginationEl.innerHTML = "";
                        return;
                    }

                    let controls = '';

                    // botão Anterior
                    controls += `<button class="pg-btn" data-page="${Math.max(1, currentPage - 1)}" ${currentPage === 1 ? 'disabled' : ''}>‹ Anterior</button>`;

                    // mostrar range de páginas; limitar para não poluir (ex.: mostrar 7 botões centrados)
                    const maxButtons = 7;
                    let startPage = Math.max(1, currentPage - Math.floor(maxButtons / 2));
                    let endPage = startPage + maxButtons - 1;
                    if (endPage > totalPages) { endPage = totalPages; startPage = Math.max(1, endPage - maxButtons + 1); }

                    if (startPage > 1) {
                        controls += `<button class="pg-btn" data-page="1">1</button>`;
                        if (startPage > 2) controls += `<span class="dots">…</span>`;
                    }

                    for (let p = startPage; p <= endPage; p++) {
                        controls += `<button class="pg-btn ${p === currentPage ? 'active' : ''}" data-page="${p}">${p}</button>`;
                    }

                    if (endPage < totalPages) {
                        if (endPage < totalPages - 1) controls += `<span class="dots">…</span>`;
                        controls += `<button class="pg-btn" data-page="${totalPages}">${totalPages}</button>`;
                    }

                    controls += `<button class="pg-btn" data-page="${Math.min(totalPages, currentPage + 1)}" ${currentPage === totalPages ? 'disabled' : ''}>Próximo ›</button>`;

                    paginationEl.innerHTML = controls;

                    paginationEl.querySelectorAll('.pg-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const p = Number(btn.dataset.page);
                            if (!isNaN(p)) renderPage(p);
                        });
                    });
                }

                renderPage(1);
            })
            .catch((error) => {
                console.error(error);
                const container = document.getElementById("listarUsuario");
                if (container) container.innerHTML = '<p>Erro ao carregar usuários.</p>';
                const ids = ["clientesCount", "vendedoresCount", "admsCount", "total"];
                ids.forEach(id => { const el = document.getElementById(id); if (el) el.textContent = "0"; });
            });
    }

    document.addEventListener('DOMContentLoaded', carregarUsuarios);
</script>





</html>
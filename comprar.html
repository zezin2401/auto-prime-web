<!DOCTYPE html>
<html lang="pt-br" dir="ltr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="assets/css/comprar.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<style>
    /* Menu lateral oculto */
    #sideMenu {
        position: fixed;
        top: 0;
        right: -250px;
        width: 250px;
        height: 100%;
        background-color: #222;
        color: #f0f0f0;
        box-shadow: -3px 0 8px rgba(0, 0, 0, 0.6);
        transition: right 0.3s ease, opacity 0.3s ease;
        padding: 30px 25px;
        font-family: 'Poppins', sans-serif;
        z-index: 1000;
        opacity: 0;
        pointer-events: none;
        display: flex;
        flex-direction: column;
    }

    #sideMenu.active {
        right: 0;
        opacity: 1;
        pointer-events: auto;
    }

    #sideMenu .closeBtn {
        font-size: 28px;
        font-weight: 700;
        cursor: pointer;
        text-align: right;
        margin-bottom: 40px;
        color: #f0f0f0;
        user-select: none;
        transition: color 0.2s ease;
    }

    #sideMenu .closeBtn:hover {
        color: #ff4d4d;
    }

    #sideMenu ul {
        list-style: none;
        padding: 0;
        margin: 0;
        flex-grow: 1;
        display: flex;
        flex-direction: column;
        gap: 25px;
    }

    #sideMenu ul li {
        font-weight: 600;
        font-size: 20px;
    }

    #sideMenu ul li a {
        color: #f0f0f0;
        text-decoration: none;
        transition: color 0.3s ease;
        padding: 10px 15px;
        border-radius: 8px;
        display: block;
    }

    #sideMenu ul li a:hover {
        background-color: #444;
        color: #ff4d4d;
    }

    .avatarheader img {
        cursor: pointer;
    }
</style>

<body>
    <header>
        <a href="home.html"><img src="assets/img/Ariel (1) 4.png" alt=""></a>

        <div class="container">
            <div class="pesquisa">
                <input class="barra-pesquisar" type="text" placeholder="Pesquisar na AutoPrime">
                <a class="avatarheader" href="#" id="avatarToggle"><img src="assets/img/login 3.png" alt="Avatar"></a>
            </div>
        </div>
    </header>

    <main>
        <section class="compra-1">
            <div class="imagem">
                <img id="produto-imagem" src="assets/img/placeholder.png" alt="Produto">
            </div>

            <div class="compra-2">
                <div class="descricao">
                    <h1 id="produto-nome">Carregando...</h1>
                    <h2 class="preco"><span class="sifrao">R$</span> <span class="dinhero"
                            id="produto-preco">0,00</span></h2>
                </div>

                <div class="vendendo">
                    <p class="vendido-por">Vendido por:</p>
                    <p id="produto-vendedor">Carregando...</p>
                </div>

                <div class="categoria">
                    <p><b>Acabamento:</b> <span id="produto-acabamento">-</span></p>

                    <div class="qtd">
                        <h3 class="titulo-qtd">Quantidade:</h3>
                        <div class="quantidade">
                            <button class="add"><i class="fa-solid fa-plus"></i></button>
                            <div class="numero">1</div>
                            <button class="menos"><i class="fa-solid fa-minus"></i></button>
                        </div>

                        <button class="botao-compra"><i class="fa-solid fa-cart-shopping"></i> Comprar agora</button>
                    </div>
                </div>
            </div>
        </section>

        <section class="detalhes">
            <div class="descricao">
                <hr>
                <h2 class="descricao-titulo">Descrição</h2>
                <p id="produto-descricao">Carregando descrição...</p>
            </div>
        </section>

        <nav id="sideMenu">
            <div class="closeBtn" id="menuClose">&times;</div>
            <ul>
                <li><a href="#">Minha Conta</a></li>
                <li><a href="#" id="logoutBtn">Logout</a></li>
            </ul>
        </nav>
    </main>

    <script>
        window.addEventListener("DOMContentLoaded", () => {
            const params = new URLSearchParams(window.location.search);

            const id_produto = params.get("id") || 0;
            const nome = params.get("nome") || "Produto sem nome";
            const preco = params.get("preco") || "0,00";
            const vendedor = params.get("vendedor") || "vendedor@gmail.com";
            const acabamento = params.get("acabamento") || "-";
            const descricao = params.get("descricao") || "Sem descrição";
            const imagem = params.get("imagem") || "assets/img/placeholder.png";

            // Seleciona elementos
            const nomeEl = document.querySelector("#produto-nome");
            const precoEl = document.querySelector("#produto-preco");
            const vendedorEl = document.querySelector("#produto-vendedor");
            const acabamentoEl = document.querySelector("#produto-acabamento");
            const descricaoEl = document.querySelector("#produto-descricao");
            const imagemEl = document.querySelector("#produto-imagem");

            nomeEl.textContent = nome;
            precoEl.textContent = parseFloat(preco).toFixed(2).replace(".", ",");
            vendedorEl.textContent = vendedor;
            acabamentoEl.textContent = acabamento;
            descricaoEl.textContent = descricao;

            // Fallback automático para imagem
            imagemEl.src = imagem;
            imagemEl.onerror = () => { imagemEl.src = "assets/img/placeholder.png"; };

            // Quantidade
            let quantidade = 1;
            const numeroEl = document.querySelector(".numero");
            document.querySelector(".add").addEventListener("click", () => {
                quantidade++;
                numeroEl.textContent = quantidade;
            });
            document.querySelector(".menos").addEventListener("click", () => {
                if (quantidade > 1) quantidade--;
                numeroEl.textContent = quantidade;
            });

            // Comprar
            document.querySelector(".botao-compra").addEventListener("click", () => {
                const precoUnit = parseFloat(preco);
                const raw = JSON.stringify({
                    email_cliente: "cliente@gmail.com",
                    email_vendedor: vendedor,
                    id_produto: parseInt(id_produto),
                    quantidade: quantidade,
                    valor_unitario: precoUnit
                });

                fetch("http://192.168.1.131:5000/venda", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: raw,
                    redirect: "follow"
                })
                    .then(res => res.text())
                    .then(result => Swal.fire({ icon: "success", title: "Compra realizada!", text: "Venda registrada com sucesso." }))
                    .catch(err => Swal.fire({ icon: "error", title: "Erro ao comprar", text: "Não foi possível realizar a compra." }));
            });
        });
    </script>
</body>

</html>
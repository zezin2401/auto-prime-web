<!DOCTYPE html>
<html lang="pt-br" dir="ltr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="assets/css/home.css">
    <script src="assets/js/segurancaadm.js"></script>
    <script src="assets/js/dashboard.js"></script>
    <script src="assets/js/vendedoresPopulares.js"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

</head>

<style>
    /* Menu lateral oculto */
    #sideMenu {
        position: fixed;
        /* Fixa na tela */
        top: 0;
        right: -250px;
        /* Inicialmente fora da tela */
        width: 250px;
        height: 100%;
        background-color: #222;
        color: #f0f0f0;
        box-shadow: -3px 0 8px rgba(0, 0, 0, 0.6);
        transition: right 0.3s ease, opacity 0.3s ease;
        /* Animação */
        padding: 30px 25px;
        font-family: 'Poppins', sans-serif;
        z-index: 1000;
        opacity: 0;
        /* Invisível */
        pointer-events: none;
        /* Não clicável */
        display: flex;
        flex-direction: column;
    }

    /* Menu ativo */
    #sideMenu.active {
        right: 0;
        /* Mostra o menu */
        opacity: 1;
        pointer-events: auto;
        /* Clicável */
    }

    /* Botão de fechar */
    #sideMenu .closeBtn {
        font-size: 28px;
        font-weight: 700;
        cursor: pointer;
        text-align: right;
        margin-bottom: 40px;
        color: #f0f0f0;
        user-select: none;
        /* Não selecionável */
        transition: color 0.2s ease;
    }

    #sideMenu .closeBtn:hover {
        color: #ff4d4d;
        /* Muda cor ao passar mouse */
    }

    /* Lista dentro do menu */
    #sideMenu ul {
        list-style: none;
        padding: 0;
        margin: 0;
        flex-grow: 1;
        display: flex;
        flex-direction: column;
        gap: 25px;
    }

    #sideMenu ul li {
        font-weight: 600;
        font-size: 20px;
    }

    #sideMenu ul li a {
        color: #f0f0f0;
        text-decoration: none;
        transition: color 0.3s ease;
        padding: 10px 15px;
        border-radius: 8px;
        display: block;
    }

    #sideMenu ul li a:hover {
        background-color: #444;
        color: #ff4d4d;
    }

    /* Cursor pointer no avatar */
    .avatarheader img {
        cursor: pointer;
    }
</style>

<body>
    <header>
        <img class="logo" src="assets/img/Ariel.png"> <!-- Logo -->
        <form>
            <input class="input-header" type="text" placeholder="Buscar na AutoPrime"> <!-- Campo de busca -->
            <button class="header-btninput" type="submit" style="padding:8px; border:none; cursor:pointer;">
                <!-- Ícone de lupa -->
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="white" viewBox="0 0 16 16">
                    <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001l3.85 3.85a1 1 0 0 0 
                    1.415-1.414l-3.85-3.85zm-5.242.656a5 
                    5 0 1 1 0-10 5 5 0 0 1 0 10z" />
                </svg>
            </button>
        </form>

        <a class="avatarheader" href="#" id="avatarToggle"><img src="assets/img/login 3.png" alt="Avatar"></a>
        <!-- Avatar clicável -->
    </header>

    <section class="banner">
        <img src="assets/img/PONTEIRAS DE 1.png" alt="">
    </section>

    <h1>Dashboard</h1>

    <section class="main">

        <div class="cards-container">

            <div class="usuario">

                <div class="icone">
                    <i class="fa-solid fa-user"></i>
                </div>
                <div class="info">
                    <p>usuario@gmail.com</p>
                    <h2 class="criado-em">Criado em: 22/09/2025</h2>
                </div>

            </div>

        </div>

        <div class="informacoes">

            <div class="ideiagenial">

                <div class="detalhes-card">

                    <div class="info-titulo">
                        <p>Usuários</p>
                    </div>
                    <div class="info-segmento-usuarios">
                        <div class="incone">
                            <i class="fa-solid fa-user"></i>
                        </div>
                        <div class="dado-e-link">
                            <p class="numero-info">500</p>
                        </div>
                    </div>
                </div>

                <a href="usuarios.html" class="botao-gerenciar"><i class="fa-solid fa-user"></i>Gerenciar Usuários</a>

            </div>

            <div class="ideiagenial">

                <div class="detalhes-card">

                    <div class="info-titulo">
                        <p>Vendas</p>
                    </div>
                    <div class="info-segmento-vendas">
                        <div class="incone">
                            <i class="fa-solid fa-cart-shopping"></i>
                        </div>
                        <div class="dado-e-link">
                            <p class="numero-info">400.000</p>
                        </div>
                    </div>
                </div>

                <a href="vendas.html" class="botao-gerenciar"><i class="fa-solid fa-cart-shopping"></i>Gerenciar
                    Vendas</a>

            </div>

            <div class="ideiagenial">

                <div class="detalhes-card">

                    <div class="info-titulo">
                        <p>Produtos</p>
                    </div>
                    <div class="info-segmento-produtos">
                        <div class="incone">
                            <i class="fa-solid fa-bag-shopping"></i>
                        </div>
                        <div class="dado-e-link">
                            <p class="numero-info">50.000</p>
                        </div>
                    </div>

                </div>

                <a href="produtos.html" class="botao-gerenciar"><i class="fa-solid fa-bag-shopping"></i>Gerenciar
                    Produtos</a>

            </div>

            <div class="ideiagenial">

                <div class="detalhes-card">

                    <div class="info-titulo">
                        <p>Cashback</p>
                    </div>
                    <div class="info-segmento-cashback">
                        <div class="incone">
                            <i class="fa-solid fa-dollar-sign"></i>
                        </div>
                        <div class="dado-e-link">
                            <p class="numero-info">R$:600,00</p>
                        </div>
                    </div>

                </div>

                <a href="cashback.html" class="botao-gerenciar"><i class="fa-solid fa-dollar-sign"></i>Gerenciar
                    Cashback</a>

            </div>

        </div>

        <div class="info-vendas">

            <div class="vendedores">

                <h2>Vendedores mais populares</h2>

                <div class="vendedores-populares">


                </div>

            </div>

            <div class="produtos">

                <h2>Produto mais vendidos</h2>

                <div class="div-produtos">

                    <div class="produto">

                        <img src="assets/img/ponta 9.png" alt="">

                        <div class="info-produto">

                            <p>Ponteira de Escapamento
                                <br>
                                Para Wolksvagem Fusca...
                            </p>

                            <p class="preco">R$79,99</p>

                        </div>

                    </div>

                    <div class="produto">

                        <img src="assets/img/ponta 9.png" alt="">

                        <div class="info-produto">

                            <p>Ponteira de Escapamento
                                <br>
                                Para Wolksvagem Fusca...
                            </p>

                            <p class="preco">R$79,99</p>

                        </div>

                    </div>

                    <div class="produto">

                        <img src="assets/img/ponta 9.png" alt="">

                        <div class="info-produto">

                            <p>Ponteira de Escapamento
                                <br>
                                Para Wolksvagem Fusca...
                            </p>

                            <p class="preco">R$79,99</p>

                        </div>

                    </div>

                </div>
            </div>

        </div>

    </section>

    <nav id="sideMenu">
        <div class="closeBtn" id="menuClose">&times;</div>
        <ul>
            <li><a href="#">Minha Conta</a></li>
            <li><a href="#" id="logoutBtn">Logout</a></li>
        </ul>
    </nav>
    <!-- Menu lateral JS -->
    <script>

        // Seleciona elementos do menu lateral
        const avatarToggle = document.getElementById('avatarToggle');
        const sideMenu = document.getElementById('sideMenu');
        const menuClose = document.getElementById('menuClose');

        // Abre menu lateral ao clicar no avatar
        avatarToggle.addEventListener('click', function (e) {
            e.preventDefault();
            sideMenu.classList.add('active');
        });

        // Fecha menu lateral ao clicar no X
        menuClose.addEventListener('click', function () {
            sideMenu.classList.remove('active');
        });

        const logoutBtn = document.getElementById('logoutBtn');

        // Função de logout
        logoutBtn.addEventListener('click', function (e) {
            e.preventDefault(); // Evita navegação do link

            localStorage.clear(); // Limpa localStorage

            // Mostra alerta de sucesso do logout
            Swal.fire({
                icon: 'success',



                title: 'Logout realizado!',
                text: 'Você será redirecionado para a página de login.',
                confirmButtonText: 'Ok'
            }).then(() => {
                window.location.href = 'login.html'; // Redireciona para login
            });
        });

        const BASE = "http://10.92.3.210:5000"; // ajusta se mudar o backend

        async function carregarProdutosMaisVendidos(topN = 3) {
            try {
                const res = await fetch(`${BASE}/produto/mais_vendido`, { headers: { Accept: 'application/json' } });
                if (!res.ok) {

                    let txt = await res.text().catch(() => null);
                    throw new Error(`API error ${res.status} ${txt ? '- ' + txt : ''}`);
                }
                const data = await res.json();

                let items = [];
                if (data.produto) items = [data.produto];
                else if (Array.isArray(data.produtos)) items = data.produtos;
                else {
                    Swal.fire('Aviso', 'Nenhum produto mais vendido foi retornado pela API.', 'info');
                    return;
                }

                items = items.slice(0, topN);

                const container = document.querySelector('.div-produtos');
                if (!container) {
                    console.error('[carregarProdutosMaisVendidos] .div-produtos não encontrado');
                    return;
                }
                container.innerHTML = '';
                items.forEach(p => {

                    let imagemUrl = 'assets/img/placeholder-produto.png';
                    if (p.imagem) {
                        const img = String(p.imagem).trim();
                        if (/^https?:\/\//i.test(img)) {
                            imagemUrl = img;
                        } else if (img.startsWith('produto/')) {

                            imagemUrl = `${BASE}/static/imagens/${img}`;
                        } else if (img.includes('/')) {
                            // tenta literal
                            imagemUrl = `${BASE}/${img}`;
                        } else {

                            imagemUrl = `${BASE}/uploads/${img}`;
                        }
                    }

                    const nome = p.nome || p.NOME || 'Produto sem nome';
                    const precoVal = (p.preco ?? p.PRECO ?? 0);
                    const preco = (Number(precoVal) && !isNaN(Number(precoVal)))
                        ? Number(precoVal).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })
                        : String(precoVal);

                    const id = p.id || p.ID || '';

                    const card = document.createElement('div');
                    card.className = 'produto';
                    card.innerHTML = `
                        <div class="imagem-produto">
                            <img src="${escapeHtml(imagemUrl)}" alt="${escapeHtml(nome)}">
                        </div>
                        <div class="detalhes-produto">
                            <div class="info-produto">
                            <p>${escapeHtml(nome)}</p>
                            <p class="preco">${preco}</p>
                            </div>
                        </div>
                        `;
                    container.appendChild(card);

                });

            } catch (err) {
                console.error('[carregarProdutosMaisVendidos]', err);
                Swal.fire({
                    icon: 'error',
                    title: 'Erro',
                    text: err.message || 'Não foi possível carregar os produtos mais vendidos.'
                });
            }
        }

        function escapeHtml(str = '') {
            return String(str).replace(/[&<>"'`]/g, s => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;', '`': '&#96;' }[s]));
        }

        // chama ao carregar a página pedindo top 3
        document.addEventListener('DOMContentLoaded', () => carregarProdutosMaisVendidos(3));
    </script>

</body>

</html>